generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Admin {
  id              Int      @id @default(autoincrement())
  name            String
  email           String   @unique
  password        String
  refreshToken    String?
  isEmailVerified Boolean  @default(false)  // ✅ Add this line
  createdAt       DateTime @default(now())
   @@map("admin")
}


model Document {
  id              Int         @id @default(autoincrement())
  title           String
  titleYo         String?     // Yoruba translation of title
  description     String?
  descriptionYo   String?     // Yoruba translation of description
  author          String
  authorYo        String?     // Yoruba translation of author
  publishedYear   Int
  publisher       String?
  referenceLink   String?
  storageUrl      String      // Supabase path
  signedUrl       String?     // Temporary access URL
  pages           Int?        // Number of pages
  readingTime     Int?        // Estimated minutes
  fileSize        Float?      // In MB
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Relations
  tags            Tag[]
  feedbacks       Feedback[]

  // ✅ Proper self-relation for related documents
  relatedDocs         Document[] @relation("RelatedDocuments")
  relatedByDocuments  Document[] @relation("RelatedDocuments")

  // Translations cache (if used for other languages)
  translations    TranslationCache[]
  @@map("document")
}



model Tag {
  id        Int        @id @default(autoincrement())
  name      String    @unique 
  documents Document[]
  @@map("tag")
}

model Feedback {
  id         Int       @id @default(autoincrement())
  rating     Int       // 1–5 stars
  comment    String?
  createdAt  DateTime  @default(now())

  // relation to Document
  document   Document  @relation(fields: [documentId], references: [id])
  documentId Int
  @@map("feedback")
}


model Translation {
  id        Int      @id @default(autoincrement())
  key       String
  locale    String   // "en" or "yo"
  value     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([key, locale]) // each key-locale pair must be unique
  @@map("translation")
}

model TranslationCache {
  id           Int      @id @default(autoincrement())
  documentId   Int
  language     String   // e.g. "yo" for Yoruba
  translated   String?  // optional, still store translated text
  fileUrl      String?  // Cloudinary/Appwrite signed URL for download
  createdAt    DateTime @default(now())

  document Document @relation(fields: [documentId], references: [id])
  @@map("translationcache")
}
